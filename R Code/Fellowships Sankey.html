<!doctype HTML>
<meta charset = 'utf-8'>
<html>
  <head>
    <link rel='stylesheet' href='/Users/jonnyc/Box Sync/Projects/specialty_paths/R Code/rCharts_d3_sankey-gh-pages/css/sankey.css'>
    
    <script src='/Users/jonnyc/Box Sync/Projects/specialty_paths/R Code/rCharts_d3_sankey-gh-pages/js/d3.v3.js' type='text/javascript'></script>
    <script src='/Users/jonnyc/Box Sync/Projects/specialty_paths/R Code/rCharts_d3_sankey-gh-pages/js/sankey.js' type='text/javascript'></script>
    
    <style>
    .rChart {
      display: block;
      margin-left: auto; 
      margin-right: auto;
      width: 960px;
      height: 760px;
    }  
    </style>
    
  </head>
  <body >
    
    <div id = 'chart132368a2fcf6' class = 'rChart rCharts_d3_sankey-gh-pages'></div>    
    <!--Attribution:
Mike Bostock https://github.com/d3/d3-plugins/tree/master/sankey
Mike Bostock http://bost.ocks.org/mike/sankey/
-->

<script>
(function(){
var params = {
 "dom": "chart132368a2fcf6",
"width":    960,
"height":    760,
"data": {
 "source": [ "Anesthesiology", "Anesthesiology", "Anesthesiology", "Anesthesiology", "Anesthesiology", "Child Neurology", "Emergency Medicine", "Emergency Medicine", "Emergency Medicine", "Emergency Medicine", "Emergency Medicine", "Family Medicine", "Family Medicine", "Family Medicine", "Family Medicine", "Family Medicine", "Family Medicine", "Family Medicine", "General Surgery", "General Surgery", "General Surgery", "General Surgery", "General Surgery", "General Surgery", "General Surgery", "General Surgery", "General Surgery", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Internal Medicine", "Medicine/Pediatrics", "Medicine/Pediatrics", "Medicine/Pediatrics", "Medicine/Pediatrics", "Medicine/Pediatrics", "Medicine/Pediatrics", "Medicine/Pediatrics", "Medicine/Pediatrics", "Medicine/Pediatrics", "Medicine/Pediatrics", "Neurological Surgery", "Neurology", "Neurology", "Neurology", "Obstetrics/Gynecology", "Obstetrics/Gynecology", "Obstetrics/Gynecology", "Obstetrics/Gynecology", "Obstetrics/Gynecology", "Obstetrics/Gynecology", "Obstetrics/Gynecology", "Obstetrics/Gynecology", "Obstetrics/Gynecology", "Obstetrics/Gynecology", "Occupational Medicine", "Orthopaedic Surgery", "Orthopaedic Surgery", "Otolaryngology", "Otolaryngology", "Otolaryngology", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Pediatrics ", "Physical Medicine and Rehabilitation", "Physical Medicine and Rehabilitation", "Physical Medicine and Rehabilitation", "Physical Medicine and Rehabilitation", "Plastic Surgery", "Psychiatry", "Psychiatry", "Psychiatry", "Psychiatry", "Psychiatry", "Psychiatry", "Radiation Oncology", "Radiology", "Radiology", "Radiology", "Thoracic Surgery", "Urology", "Urology", "Urology", "Vascular Surgery" ],
"target": [ "Headache Medicine", "Hospice and Palliative Medicine", "Obstetric Anesthesiology", "Pediatric Anesthesiology", "Surgical Critical Care ", "Headache Medicine", "Hospice and Palliative Medicine", "Medical Toxicology ", "Pediatric Emergency Medicine", "Primary Care Sports Medicine ", "Surgical Critical Care ", "Adolescent Medicine ", "Allergy / Immunology ", "Geriatric Medicine ", "Headache Medicine", "Medical Toxicology ", "Primary Care Sports Medicine ", "Sleep Medicine ", "Colon and Rectal Surgery", "Combined Musculoskeletal – Hand Surgery ", "Hospice and Palliative Medicine", "Pediatric Surgery ", "Surgical Critical Care ", "Surgical Oncology ", "Thoracic Surgery ", "Vascular Surgery ", "Abdominal Transplant Surgery ", "Adolescent Medicine ", "Allergy / Immunology ", "Cardiovascular Disease", "Endocrinology", "Gastroenterology", "Geriatric Medicine ", "Headache Medicine", "Hematology", "Hematology/Medical Oncology", "Infectious Disease", "Interventional Pulmonology", "Medical Oncology", "Medical Toxicology ", "Nephrology", "Primary Care Sports Medicine ", "Pulmonary Disease ", "Pulmonary/Critical Care Medicine", "Rheumatology", "Sleep Medicine ", "Adolescent Medicine ", "Neonatal-Perinatal Medicine", "Pediatric Cardiology (Spring)", "Pediatric Endocrinology", "Pediatric Gastroeneterology", "Pediatric Hematology/Oncology (Spring)", "Pediatric Hospital Medicine", "Pediatric Infectious Disease", "Pediatric Pulmonology", "Pediatric Rheumatology", "Surgical Critical Care ", "Brain Injury Medicine", "Sleep Medicine ", "Vascular Neurology ", "Gynecologic Oncology", "Headache Medicine", "Hospice and Palliative Medicine", "Maternal-Fetal Medicine", "Maternal-Fetal Medicine", "Minimally Invasive Gynecologic Surgery", "Pediatric and Adolescent Gynecology", "Reproductive Endocrinology", "Surgical Critical Care ", "Female Pelvic Medicine and Reconstructive Surgery ", "Medical Toxicology ", "Combined Musculoskeletal – Hand Surgery ", "Surgical Critical Care ", "Laryngology ", "Sleep Medicine ", "Surgical Critical Care ", "Adolescent Medicine ", "Allergy / Immunology ", "Child Abuse", "Developmental-Behavioral Pediatrics", "Headache Medicine", "Medical Toxicology ", "Neonatal-Perinatal Medicine", "Pediatric Emergency Medicine", "Pediatric Endocrinology", "Pediatric Gastroeneterology", "Pediatric Hospital Medicine", "Pediatric Infectious Disease", "Pediatric Nephrology", "Pediatric Pulmonology", "Pediatric Rheumatology", "Sleep Medicine ", "Pediatric Cardiology (Spring)", "Pediatric Hematology/Oncology (Spring)", "Primary Care Sports Medicine ", "Brain Injury Medicine", "Headache Medicine", "Pediatric Rehabilitation Medicine", "Primary Care Sports Medicine ", "Combined Musculoskeletal – Hand Surgery ", "Brain Injury Medicine", "Child and Adolescent Psychiatry", "Headache Medicine", "Hospice and Palliative Medicine", "Psychomatic Medicine", "Sleep Medicine ", "Hospice and Palliative Medicine", "Hospice and Palliative Medicine", "Neuroradiology", "Vascular / Interventional Radiology", "Surgical Critical Care ", "Abdominal Transplant Surgery ", "Female Pelvic Medicine and Reconstructive Surgery ", "Surgical Critical Care ", "Surgical Critical Care " ],
"value": [ 0.73775, 53.316, 6.0602, 14.599, 29.978, 46.343, 3.3968,  44.71, 71.794, 7.7347, 51.287, 61.566, 13.761, 18.025, 95.545, 6.7128, 22.709, 33.755, 59.897, 68.561, 51.111, 97.495, 56.824,  9.886, 1.7824, 57.207, 40.556, 39.282, 50.647, 3.8353, 42.908, 26.707,  59.54, 94.871, 9.0337, 40.158, 6.9374,  22.22, 53.814, 44.964,  13.34, 4.8412,  15.27,  52.63, 73.993, 82.089, 11.683, 32.655,  65.89, 58.666, 77.976, 87.501, 25.578, 0.90621, 13.948, 24.662, 43.747, 0.73775, 53.316, 6.0602, 14.599, 29.978, 46.343, 3.3968,  44.71, 71.794, 7.7347, 51.287, 61.566, 13.761, 18.025, 95.545, 6.7128, 22.709, 33.755, 59.897, 68.561, 51.111, 97.495, 56.824,  9.886, 1.7824, 57.207, 40.556, 39.282, 50.647, 3.8353, 42.908, 26.707,  59.54, 94.871, 9.0337, 40.158, 6.9374,  22.22, 53.814, 44.964,  13.34, 4.8412,  15.27,  52.63, 73.993, 82.089, 11.683, 32.655,  65.89, 58.666, 77.976, 87.501, 25.578, 0.90621, 13.948, 24.662, 43.747, 0.73775 ] 
},
"nodeWidth":     15,
"nodePadding":     10,
"layout":     32,
"id": "chart132368a2fcf6" 
};

params.units ? units = " " + params.units : units = "";

//hard code these now but eventually make available
var formatNumber = d3.format("0,.0f"),    // zero decimal places
    format = function(d) { return formatNumber(d) + units; },
    color = d3.scale.category20();

if(params.labelFormat){
  formatNumber = d3.format(".2%");
}

var svg = d3.select('#' + params.id).append("svg")
    .attr("width", params.width)
    .attr("height", params.height);
    
var sankey = d3.sankey()
    .nodeWidth(params.nodeWidth)
    .nodePadding(params.nodePadding)
    .layout(params.layout)
    .size([params.width,params.height]);
    
var path = sankey.link();
    
var data = params.data,
    links = [],
    nodes = [];
    
//get all source and target into nodes
//will reduce to unique in the next step
//also get links in object form
data.source.forEach(function (d, i) {
    nodes.push({ "name": data.source[i] });
    nodes.push({ "name": data.target[i] });
    links.push({ "source": data.source[i], "target": data.target[i], "value": +data.value[i] });
}); 

//now get nodes based on links data
//thanks Mike Bostock https://groups.google.com/d/msg/d3-js/pl297cFtIQk/Eso4q_eBu1IJ
//this handy little function returns only the distinct / unique nodes
nodes = d3.keys(d3.nest()
                .key(function (d) { return d.name; })
                .map(nodes));

//it appears d3 with force layout wants a numeric source and target
//so loop through each link replacing the text with its index from node
links.forEach(function (d, i) {
    links[i].source = nodes.indexOf(links[i].source);
    links[i].target = nodes.indexOf(links[i].target);
});

//now loop through each nodes to make nodes an array of objects rather than an array of strings
nodes.forEach(function (d, i) {
    nodes[i] = { "name": d };
});

sankey
  .nodes(nodes)
  .links(links)
  .layout(params.layout);
  
var link = svg.append("g").selectAll(".link")
  .data(links)
.enter().append("path")
  .attr("class", "link")
  .attr("d", path)
  .style("stroke-width", function (d) { return Math.max(1, d.dy); })
  .sort(function (a, b) { return b.dy - a.dy; });

link.append("title")
  .text(function (d) { return d.source.name + " → " + d.target.name + "\n" + format(d.value); });

var node = svg.append("g").selectAll(".node")
  .data(nodes)
.enter().append("g")
  .attr("class", "node")
  .attr("transform", function (d) { return "translate(" + d.x + "," + d.y + ")"; })
.call(d3.behavior.drag()
  .origin(function (d) { return d; })
  .on("dragstart", function () { this.parentNode.appendChild(this); })
  .on("drag", dragmove));

node.append("rect")
  .attr("height", function (d) { return d.dy; })
  .attr("width", sankey.nodeWidth())
  .style("fill", function (d) { return d.color = color(d.name.replace(/ .*/, "")); })
  .style("stroke", function (d) { return d3.rgb(d.color).darker(2); })
.append("title")
  .text(function (d) { return d.name + "\n" + format(d.value); });

node.append("text")
  .attr("x", -6)
  .attr("y", function (d) { return d.dy / 2; })
  .attr("dy", ".35em")
  .attr("text-anchor", "end")
  .attr("transform", null)
  .text(function (d) { return d.name; })
.filter(function (d) { return d.x < params.width / 2; })
  .attr("x", 6 + sankey.nodeWidth())
  .attr("text-anchor", "start");

// the function for moving the nodes
  function dragmove(d) {
    d3.select(this).attr("transform", 
        "translate(" + (
                   d.x = Math.max(0, Math.min(params.width - d.dx, d3.event.x))
                ) + "," + (
                   d.y = Math.max(0, Math.min(params.height - d.dy, d3.event.y))
                ) + ")");
        sankey.relayout();
        link.attr("d", path);
  }
})();
</script>
    
    <script></script>    
  </body>
</html>
